<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Script Generator Pro</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Matrix-inspired Theme */
    :root {
      --matrix-bg: #0c0c0c;
      --matrix-text: #00ff41;
      --matrix-glow: #00ff4155;
      --matrix-dim: #0f3d0f;
      --matrix-highlight: #00ff97;
      --matrix-panel: #0f0f0f;
      --matrix-border: #143214;
      --matrix-error: #ff2222;
      --matrix-warning: #ffe100;
      --matrix-success: #00ff41;
      --matrix-font: 'Courier New', monospace;
      --matrix-secondary: #072707;
      --animation-speed: 0.5s;
    }

    /* Reset and Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: var(--matrix-font);
    }

    body {
      background-color: var(--matrix-bg);
      color: var(--matrix-text);
      font-family: var(--matrix-font);
      line-height: 1.6;
      overflow-x: hidden;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Digital Rain Effect */
    .digital-rain {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      opacity: 0.3;
    }

    /* Glow and Text Effects */
    .glow {
      text-shadow: 0 0 10px var(--matrix-glow);
      animation: pulse 2s infinite;
    }

    .matrix-text {
      color: var(--matrix-text);
      font-family: var(--matrix-font);
    }

    .highlight {
      color: var(--matrix-highlight);
    }

    @keyframes pulse {
      0% { text-shadow: 0 0 4px var(--matrix-glow); }
      50% { text-shadow: 0 0 16px var(--matrix-glow); }
      100% { text-shadow: 0 0 4px var(--matrix-glow); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideInRight {
      from { transform: translateX(50px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideInLeft {
      from { transform: translateX(-50px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* Layout Components */
    .container {
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      opacity: 0;
      animation: fadeIn 1s forwards;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid var(--matrix-border);
      margin-bottom: 20px;
      animation: slideInRight 0.7s forwards;
    }

    .logo {
      font-size: 24px;
      font-weight: bold;
      display: flex;
      align-items: center;
    }

    .logo i {
      margin-right: 10px;
    }

    .nav {
      display: flex;
      gap: 20px;
    }

    .main {
      display: flex;
      flex: 1;
      gap: 20px;
      opacity: 0;
      animation: fadeIn 1s 0.3s forwards;
    }

    .sidebar {
      width: 270px;
      background-color: var(--matrix-panel);
      border-radius: 5px;
      border: 1px solid var(--matrix-border);
      padding: 15px;
      box-shadow: 0 0 15px rgba(0, 255, 65, 0.1);
      animation: slideInLeft 0.5s forwards;
    }

    .content {
      flex: 1;
      border-radius: 5px;
      animation: slideInRight 0.5s forwards;
    }

    /* Panels and Cards */
    .panel {
      background-color: var(--matrix-panel);
      border: 1px solid var(--matrix-border);
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 0 15px rgba(0, 255, 65, 0.1);
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(to right, var(--matrix-bg), var(--matrix-text), var(--matrix-bg));
      opacity: 0;
      transition: opacity var(--animation-speed);
    }

    .panel:hover::before {
      opacity: 1;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--matrix-border);
    }

    .panel-title {
      font-size: 16px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .panel-actions {
      display: flex;
      gap: 10px;
    }

    /* Form Elements */
    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      background-color: rgba(0, 30, 0, 0.3);
      border: 1px solid var(--matrix-border);
      border-radius: 3px;
      color: var(--matrix-text);
      font-family: var(--matrix-font);
      outline: none;
      transition: all 0.3s ease;
    }

    input:focus, textarea:focus, select:focus {
      border-color: var(--matrix-text);
      box-shadow: 0 0 5px var(--matrix-glow);
    }

    textarea {
      min-height: 100px;
      resize: vertical;
    }

    /* Buttons */
    .btn {
      padding: 8px 16px;
      background-color: var(--matrix-secondary);
      color: var(--matrix-text);
      border: 1px solid var(--matrix-border);
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: var(--matrix-font);
      position: relative;
      overflow: hidden;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(transparent, rgba(0, 255, 65, 0.1), transparent);
      transform: rotate(30deg);
      transition: transform 0.5s;
      transform-origin: center;
      opacity: 0;
    }

    .btn:hover {
      background-color: var(--matrix-dim);
      box-shadow: 0 0 10px var(--matrix-glow);
    }

    .btn:hover::after {
      transform: rotate(30deg) translateY(0);
      opacity: 1;
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn i {
      margin-right: 8px;
    }

    .btn-primary {
      background-color: var(--matrix-dim);
    }

    .btn-danger {
      background-color: #3d0000;
      color: var(--matrix-error);
    }

    .btn-warn {
      background-color: #3d3d00;
      color: var(--matrix-warning);
    }

    /* Status and Indicators */
    .status {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 3px;
      font-size: 12px;
      margin-right: 5px;
    }

    .status-success {
      background-color: rgba(0, 255, 65, 0.2);
      color: var(--matrix-success);
    }

    .status-warning {
      background-color: rgba(255, 225, 0, 0.2);
      color: var(--matrix-warning);
    }

    .status-error {
      background-color: rgba(255, 34, 34, 0.2);
      color: var(--matrix-error);
    }

    /* Lists and Tables */
    .list {
      list-style: none;
    }

    .list-item {
      padding: 10px;
      border-bottom: 1px solid var(--matrix-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.3s;
    }

    .list-item:hover {
      background-color: var(--matrix-secondary);
      cursor: pointer;
    }

    .list-item:last-child {
      border-bottom: none;
    }

    .list-item-title {
      font-weight: bold;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid var(--matrix-border);
    }

    th {
      background-color: var(--matrix-secondary);
      font-weight: bold;
      text-transform: uppercase;
      font-size: 12px;
      letter-spacing: 1px;
    }

    tr:hover {
      background-color: var(--matrix-secondary);
    }

    /* Code Display */
    .code-container {
      position: relative;
      margin-bottom: 20px;
      background-color: rgba(0, 30, 0, 0.3);
      padding: 15px;
      border-radius: 3px;
      border: 1px solid var(--matrix-border);
    }

    .code {
      font-family: monospace;
      overflow-x: auto;
      white-space: pre;
      line-height: 1.4;
      max-height: 300px;
      overflow-y: auto;
    }

    .code-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--matrix-border);
    }

    .code-title {
      font-size: 14px;
      font-weight: bold;
    }

    .code-actions {
      display: flex;
      gap: 10px;
    }

    /* Terminal Effect */
    .terminal {
      height: 300px;
      overflow-y: auto;
      padding: 10px;
      background-color: rgba(0, 10, 0, 0.5);
      font-family: monospace;
      border-radius: 3px;
      border: 1px solid var(--matrix-border);
    }

    .terminal-line {
      margin-bottom: 5px;
      display: flex;
    }

    .terminal-prompt {
      color: var(--matrix-highlight);
      margin-right: 10px;
    }

    /* Loading Spinner */
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid transparent;
      border-top-color: var(--matrix-text);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--matrix-border);
      margin-bottom: 15px;
    }

    .tab {
      padding: 10px 15px;
      cursor: pointer;
      position: relative;
      transition: all 0.3s;
    }

    .tab::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 100%;
      height: 2px;
      background-color: var(--matrix-text);
      transform: scaleX(0);
      transition: transform 0.3s;
    }

    .tab:hover, .tab.active {
      color: var(--matrix-highlight);
    }

    .tab.active::after {
      transform: scaleX(1);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.5s;
    }

    /* Badge */
    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 10px;
      font-size: 12px;
      background-color: var(--matrix-dim);
      color: var(--matrix-text);
      margin-right: 5px;
      white-space: nowrap;
    }

    /* Progress Bar */
    .progress-bar {
      height: 10px;
      background-color: var(--matrix-secondary);
      border-radius: 5px;
      margin: 10px 0;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background-color: var(--matrix-text);
      transition: width 0.3s ease;
    }

    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--matrix-secondary);
      transition: .4s;
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: var(--matrix-text);
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: var(--matrix-dim);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }

    /* Scroll to Top Button */
    .scroll-top {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--matrix-dim);
      color: var(--matrix-text);
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      z-index: 100;
      border: 1px solid var(--matrix-border);
    }

    .scroll-top.visible {
      opacity: 1;
    }

    .scroll-top:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 10px var(--matrix-glow);
    }

    /* Settings */
    .settings-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border: 1px solid var(--matrix-border);
      border-radius: 3px;
      background-color: rgba(0, 30, 0, 0.3);
    }

    .setting-label {
      font-weight: bold;
    }

    /* Notification */
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      max-width: 300px;
      background-color: var(--matrix-panel);
      border: 1px solid var(--matrix-border);
      border-left: 4px solid var(--matrix-text);
      padding: 15px;
      border-radius: 3px;
      box-shadow: 0 0 15px rgba(0, 255, 65, 0.2);
      z-index: 1000;
      display: flex;
      align-items: center;
      transform: translateY(20px);
      opacity: 0;
      transition: transform 0.3s, opacity 0.3s;
    }

    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }

    .notification-success {
      border-left-color: var(--matrix-success);
    }

    .notification-error {
      border-left-color: var(--matrix-error);
    }

    .notification-warning {
      border-left-color: var(--matrix-warning);
    }

    .notification-icon {
      margin-right: 10px;
      font-size: 20px;
    }

    .notification-message {
      flex: 1;
    }

    .notification-close {
      margin-left: 10px;
      cursor: pointer;
      color: var(--matrix-text);
      transition: color 0.3s;
    }

    .notification-close:hover {
      color: var(--matrix-highlight);
    }

    /* Modal */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 10, 0, 0.8);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .modal-backdrop.show {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      width: 100%;
      max-width: 600px;
      background-color: var(--matrix-panel);
      border: 1px solid var(--matrix-border);
      border-radius: 5px;
      transform: scale(0.9);
      transition: transform 0.3s;
    }

    .modal-backdrop.show .modal {
      transform: scale(1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      border-bottom: 1px solid var(--matrix-border);
    }

    .modal-title {
      font-size: 18px;
      font-weight: bold;
    }

    .modal-close {
      cursor: pointer;
      font-size: 20px;
      color: var(--matrix-text);
      transition: color 0.3s;
      background: none;
      border: none;
    }

    .modal-close:hover {
      color: var(--matrix-highlight);
    }

    .modal-body {
      padding: 15px;
      max-height: 70vh;
      overflow-y: auto;
    }

    .modal-footer {
      padding: 15px;
      border-top: 1px solid var(--matrix-border);
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    /* Category Pills */
    .category-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0;
    }

    .category-pill {
      padding: 5px 10px;
      border-radius: 15px;
      background-color: var(--matrix-secondary);
      color: var(--matrix-text);
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
    }

    .category-pill:hover, .category-pill.active {
      background-color: var(--matrix-dim);
      box-shadow: 0 0 5px var(--matrix-glow);
    }

    /* Script Item */
    .script-item {
      border: 1px solid var(--matrix-border);
      border-radius: 5px;
      margin-bottom: 15px;
      overflow: hidden;
      background-color: rgba(0, 30, 0, 0.2);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .script-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 255, 65, 0.1);
    }

    .script-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      background-color: var(--matrix-secondary);
      border-bottom: 1px solid var(--matrix-border);
    }

    .script-title {
      font-weight: bold;
      flex: 1;
    }

    .script-subtitle {
      color: rgba(0, 255, 65, 0.7);
      font-size: 12px;
      margin-top: 5px;
    }

    .script-body {
      height: 0;
      overflow: hidden;
      transition: height 0.3s;
    }

    .script-body.open {
      height: auto;
    }

    .script-content {
      padding: 15px;
    }

    .script-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      background-color: rgba(0, 30, 0, 0.3);
      border-top: 1px solid var(--matrix-border);
    }

    .script-meta {
      font-size: 12px;
      color: rgba(0, 255, 65, 0.7);
    }

    .script-actions {
      display: flex;
      gap: 10px;
    }

    /* Flex Utilities */
    .d-flex {
      display: flex;
    }

    .flex-column {
      flex-direction: column;
    }

    .justify-between {
      justify-content: space-between;
    }

    .align-center {
      align-items: center;
    }

    .flex-grow {
      flex-grow: 1;
    }

    /* Spacing Utilities */
    .mt-2 {
      margin-top: 10px;
    }

    .mb-2 {
      margin-bottom: 10px;
    }

    .mb-3 {
      margin-bottom: 15px;
    }

    .ml-2 {
      margin-left: 10px;
    }

    .mr-2 {
      margin-right: 10px;
    }

    /* Generator Jobs */
    .generator-job {
      border: 1px solid var(--matrix-border);
      border-radius: 5px;
      margin-bottom: 10px;
      padding: 10px;
      background-color: rgba(0, 30, 0, 0.3);
    }

    .generator-job-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .generator-job-title {
      font-weight: bold;
    }

    .generator-job-status {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .generator-job-progress {
      margin: 10px 0;
    }

    .generator-job-details {
      font-size: 12px;
      color: rgba(0, 255, 65, 0.7);
    }

    .generator-job-actions {
      margin-top: 10px;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    /* Mode switch styles */
    .mode-switch-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 15px;
      padding: 10px;
      background-color: var(--matrix-secondary);
      border-radius: 5px;
      border: 1px solid var(--matrix-border);
    }

    .mode-label {
      margin: 0 10px;
      font-weight: bold;
    }

    /* Keyword management */
    .keyword-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      border: 1px solid var(--matrix-border);
      border-radius: 3px;
      margin-bottom: 8px;
      background-color: rgba(0, 30, 0, 0.2);
    }

    .keyword-text {
      flex-grow: 1;
    }

    .keyword-actions {
      display: flex;
      gap: 5px;
    }

    .keyword-badge {
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 10px;
      background-color: var(--matrix-dim);
      color: var(--matrix-text);
    }

    /* Connection status */
    .connection-status {
      position: fixed;
      bottom: 10px;
      left: 10px;
      padding: 5px 10px;
      border-radius: 3px;
      font-size: 12px;
      background-color: var(--matrix-panel);
      border: 1px solid var(--matrix-border);
      z-index: 100;
    }

    /* Media Queries */
    @media (max-width: 992px) {
      .main {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        margin-bottom: 20px;
      }

      .settings-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
      }

      .nav {
        margin-top: 10px;
        width: 100%;
        overflow-x: auto;
        padding-bottom: 5px;
      }
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--matrix-bg);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--matrix-dim);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--matrix-text);
    }

    /* Footer */
    .footer {
      border-top: 1px solid var(--matrix-border);
      padding-top: 20px;
      margin-top: 20px;
      text-align: center;
      font-size: 12px;
      color: rgba(0, 255, 65, 0.7);
    }
  </style>
</head>
<body>
  <!-- Digital Rain Canvas -->
  <canvas id="digitalRain" class="digital-rain"></canvas>

  <div class="connection-status" id="connectionStatus">
    <i class="fas fa-plug"></i> Connecting...
  </div>

  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo glow">
        <i class="fas fa-terminal"></i>
        <span>SCRIPT GENERATOR PRO</span>
      </div>
      <nav class="nav">
        <button id="keywordsBtn" class="btn">
          <i class="fas fa-tags"></i> Keywords
        </button>
        <button id="settingsBtn" class="btn">
          <i class="fas fa-cog"></i> Settings
        </button>
        <button id="exportBtn" class="btn">
          <i class="fas fa-download"></i> Export
        </button>
        <button id="modeToggle" class="btn">
          <i class="fas fa-adjust"></i>
        </button>
      </nav>
    </header>

    <!-- Main Content -->
    <main class="main">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">Generation Mode</div>
          </div>
          <div class="mode-switch-container">
            <span class="mode-label">AUTO</span>
            <label class="toggle-switch">
              <input type="checkbox" id="modeSwitch">
              <span class="toggle-slider"></span>
            </label>
            <span class="mode-label">MANUAL</span>
          </div>
          <div id="modeDescription" class="mb-2">
            Auto mode: Scripts are generated automatically based on trending keywords.
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">Status</div>
          </div>
          <div id="statusPanel">
            <div class="d-flex justify-between align-center mb-2">
              <span>Service Status:</span>
              <span class="status status-success" id="serviceStatus">Ready</span>
            </div>
            <div class="d-flex justify-between align-center mb-2">
              <span>API Status:</span>
              <span class="status status-success" id="apiStatus">Connected</span>
            </div>
            <div class="d-flex justify-between align-center mb-2">
              <span>Last Update:</span>
              <span id="lastUpdate">Never</span>
            </div>
            <div class="d-flex justify-between align-center mb-2">
              <span>Scripts Generated:</span>
              <span id="scriptsCount">0</span>
            </div>
            <div class="d-flex justify-between align-center mb-2">
              <span>Active Jobs:</span>
              <span id="activeJobsCount">0</span>
            </div>
            <div class="d-flex flex-column mb-2">
              <span class="mb-2">API Usage:</span>
              <div class="progress-bar">
                <div class="progress-bar-fill" id="apiUsage" style="width: 0%"></div>
              </div>
              <span class="script-meta" id="apiUsageText">0%</span>
            </div>
          </div>
          <div id="autoModeControls" class="d-flex justify-between mt-2">
            <button id="startBtn" class="btn btn-primary">
              <i class="fas fa-play"></i> Start
            </button>
            <button id="pauseBtn" class="btn btn-warn" disabled>
              <i class="fas fa-pause"></i> Pause
            </button>
            <button id="stopBtn" class="btn btn-danger" disabled>
              <i class="fas fa-stop"></i> Stop
            </button>
          </div>
          <div id="manualModeControls" class="mt-2" style="display: none;">
            <button id="createJobBtn" class="btn btn-primary w-100">
              <i class="fas fa-plus"></i> Create New Job
            </button>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">Categories</div>
            <div class="panel-actions">
              <button id="addCategoryBtn" class="btn btn-primary">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
          <div id="categoriesList" class="list">
            <!-- Categories will be loaded from server -->
            <div class="list-item" id="categories-loading">
              <span class="list-item-title">Loading categories...</span>
              <div class="spinner"></div>
            </div>
          </div>
        </div>

        <div id="topKeywordsPanel" class="panel">
          <div class="panel-header">
            <div class="panel-title">Active Keywords</div>
          </div>
          <div class="terminal" id="keywordsTerminal" style="height: 200px">
            <div class="terminal-line">
              <span class="terminal-prompt">$</span>
              <span>Loading keywords...</span>
            </div>
          </div>
        </div>
      </aside>

      <!-- Content Area -->
      <section class="content">
        <!-- Generator Jobs Panel -->
        <div id="generatorJobsPanel" class="panel">
          <div class="panel-header">
            <div class="panel-title">Generator Jobs</div>
            <div class="panel-actions">
              <button id="refreshJobsBtn" class="btn">
                <i class="fas fa-sync-alt"></i> Refresh
              </button>
            </div>
          </div>

          <div id="noJobs" class="mb-3">
            No active generation jobs. Start the generator or create a new job.
          </div>

          <div id="generatorJobsList">
            <!-- Generator jobs will be added here dynamically -->
          </div>
        </div>

        <!-- Manual Job Creation Panel -->
        <div id="manualJobPanel" class="panel" style="display: none;">
          <div class="panel-header">
            <div class="panel-title">Create Manual Script Generation Job</div>
          </div>

          <div class="mb-3">
            <label for="jobName">Job Name:</label>
            <input type="text" id="jobName" placeholder="Enter a name for this job">
          </div>

          <div class="mb-3">
            <label for="jobKeywords">Keywords/Theme:</label>
            <textarea id="jobKeywords" placeholder="Enter keywords or theme for script generation"></textarea>
          </div>

          <div class="settings-grid mb-3">
            <div class="setting-item">
              <span class="setting-label">Script Count:</span>
              <input type="number" id="scriptCount" min="1" max="10" value="3">
            </div>
            <div class="setting-item">
              <span class="setting-label">Category:</span>
              <select id="scriptCategory">
                <option value="all">All Categories</option>
                <!-- Categories will be added dynamically -->
              </select>
            </div>
            <div class="setting-item">
              <span class="setting-label">Generate Bash:</span>
              <div class="toggle-switch">
                <input type="checkbox" id="generateBashManual" checked>
                <span class="toggle-slider"></span>
              </div>
            </div>
            <div class="setting-item">
              <span class="setting-label">Generate PowerShell:</span>
              <div class="toggle-switch">
                <input type="checkbox" id="generatePowershellManual" checked>
                <span class="toggle-slider"></span>
              </div>
            </div>
          </div>

          <div class="d-flex justify-between">
            <button id="cancelManualJobBtn" class="btn btn-danger">
              <i class="fas fa-times"></i> Cancel
            </button>
            <button id="startManualJobBtn" class="btn btn-primary">
              <i class="fas fa-play"></i> Start Generation
            </button>
          </div>
        </div>

        <!-- Scripts Generator Panel -->
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">Generated Scripts</div>
            <div class="panel-actions">
              <button id="refreshBtn" class="btn">
                <i class="fas fa-sync-alt"></i> Refresh
              </button>
              <select id="scriptTypeFilter">
                <option value="all">All Types</option>
                <option value="bash">Bash (.sh)</option>
                <option value="powershell">PowerShell (.ps1)</option>
              </select>
            </div>
          </div>

          <div class="category-pills" id="categoryPills">
            <div class="category-pill active" data-category="all">All</div>
            <!-- Categories will be added dynamically -->
          </div>

          <div id="searchContainer" class="mb-3">
            <input type="text" id="searchInput" placeholder="Search scripts...">
            <div class="d-flex justify-between align-center">
              <span id="searchResults">Showing all scripts</span>
              <div>
                <label for="sortOrder">Sort by:</label>
                <select id="sortOrder">
                  <option value="date-desc">Newest First</option>
                  <option value="date-asc">Oldest First</option>
                  <option value="name-asc">Name (A-Z)</option>
                  <option value="name-desc">Name (Z-A)</option>
                </select>
              </div>
            </div>
          </div>

          <div id="scriptsList">
            <!-- Scripts will be dynamically added here -->
          </div>

          <div id="loadingScripts" class="d-flex align-center justify-between" style="display: none;">
            <span>Loading scripts...</span>
            <div class="spinner"></div>
          </div>

          <div id="noScripts" class="d-flex align-center justify-between">
            <span>No scripts found. Start the generator to create new scripts.</span>
          </div>
        </div>

        <!-- Log Terminal Panel -->
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">Activity Log</div>
            <div class="panel-actions">
              <button id="clearLogBtn" class="btn">
                <i class="fas fa-trash"></i> Clear
              </button>
            </div>
          </div>
          <div class="terminal" id="logTerminal">
            <div class="terminal-line">
              <span class="terminal-prompt">$</span>
              <span>System initialized. Ready to generate scripts.</span>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <p>Script Generator Pro v3.0.0 | Copyright © 2025 | Matrix Interface</p>
    </footer>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Settings</div>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="settings-grid">
          <div class="setting-item">
            <span class="setting-label">Model</span>
            <select id="gptModel">
              <option value="gpt-4-turbo-preview">GPT-4 Turbo</option>
              <option value="gpt-4">GPT-4</option>
              <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
            </select>
          </div>
          <div class="setting-item">
            <span class="setting-label">Update Interval (minutes)</span>
            <input type="number" id="updateInterval" min="5" max="1440" value="30">
          </div>
          <div class="setting-item">
            <span class="setting-label">Scripts Per Update</span>
            <input type="number" id="scriptsPerUpdate" min="1" max="20" value="5">
          </div>
          <div class="setting-item">
            <span class="setting-label">Auto-Start</span>
            <div class="toggle-switch">
              <input type="checkbox" id="autoStart">
              <span class="toggle-slider"></span>
            </div>
          </div>
          <div class="setting-item">
            <span class="setting-label">Include SEO Keywords</span>
            <div class="toggle-switch">
              <input type="checkbox" id="includeSeo" checked>
              <span class="toggle-slider"></span>
            </div>
          </div>
          <div class="setting-item">
            <span class="setting-label">Generate Bash Scripts (.sh)</span>
            <div class="toggle-switch">
              <input type="checkbox" id="generateBash" checked>
              <span class="toggle-slider"></span>
            </div>
          </div>
          <div class="setting-item">
            <span class="setting-label">Generate PowerShell Scripts (.ps1)</span>
            <div class="toggle-switch">
              <input type="checkbox" id="generatePowershell" checked>
              <span class="toggle-slider"></span>
            </div>
          </div>
          <div class="setting-item">
            <span class="setting-label">Balance Categories</span>
            <div class="toggle-switch">
              <input type="checkbox" id="balanceCategories" checked>
              <span class="toggle-slider"></span>
            </div>
          </div>
          <div class="setting-item">
            <span class="setting-label">Max Parallel Jobs</span>
            <input type="number" id="maxParallelJobs" min="1" max="10" value="3">
          </div>
          <div class="setting-item">
            <span class="setting-label">Cache Enabled</span>
            <div class="toggle-switch">
              <input type="checkbox" id="cacheEnabled" checked>
              <span class="toggle-slider"></span>
            </div>
          </div>
        </div>

        <div>
          <h3 class="mb-2">Advanced Settings</h3>
          <div class="mb-3">
            <label for="maxTokens">Max Tokens per Request:</label>
            <input type="number" id="maxTokens" min="100" max="8000" value="2000">
          </div>
          <div class="mb-3">
            <label for="temperature">Temperature:</label>
            <input type="range" id="temperature" min="0" max="1" step="0.1" value="0.7">
            <span id="temperatureValue">0.7</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="resetSettingsBtn" class="btn btn-danger">Reset to Default</button>
        <button id="saveSettingsBtn" class="btn btn-primary">Save Settings</button>
      </div>
    </div>
  </div>

  <!-- Add Category Modal -->
  <div id="addCategoryModal" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Add New Category</div>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="newCategoryName">Category Name:</label>
          <input type="text" id="newCategoryName" placeholder="Enter category name">
        </div>
        <div class="mb-3">
          <label for="newCategoryDesc">Description (optional):</label>
          <textarea id="newCategoryDesc" placeholder="Enter category description"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button id="cancelAddCategoryBtn" class="btn">Cancel</button>
        <button id="saveNewCategoryBtn" class="btn btn-primary">Add Category</button>
      </div>
    </div>
  </div>

  <!-- Keywords Management Modal -->
  <div id="keywordsModal" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Manage Keywords</div>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="newKeyword">Add Keyword:</label>
          <div class="d-flex">
            <input type="text" id="newKeyword" placeholder="Enter new keyword" style="flex: 1;">
            <button id="addKeywordBtn" class="btn btn-primary ml-2">
              <i class="fas fa-plus"></i> Add
            </button>
          </div>
        </div>
        
        <div class="mb-3">
          <div class="d-flex justify-between align-center mb-2">
            <h3>Current Keywords</h3>
            <button id="fetchKeywordsBtn" class="btn btn-primary">
              <i class="fas fa-sync-alt"></i> Fetch Trending
            </button>
          </div>
          
          <div id="keywordsList">
            <!-- Keywords will be added here dynamically -->
            <div id="keywordsLoading" class="d-flex align-center justify-between">
              <span>Loading keywords...</span>
              <div class="spinner"></div>
            </div>
          </div>
          
          <div id="noKeywords" style="display: none;">
            No keywords added yet. Add keywords manually or fetch trending keywords.
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="clearKeywordsBtn" class="btn btn-danger">Clear All</button>
        <button id="saveKeywordsBtn" class="btn btn-primary">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Export Modal -->
  <div id="exportModal" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Export Scripts</div>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label>Select Export Format:</label>
          <div class="d-flex mt-2">
            <label class="mr-2">
              <input type="radio" name="exportFormat" value="zip" checked> ZIP Archive
            </label>
            <label class="mr-2">
              <input type="radio" name="exportFormat" value="folder"> Folder Structure
            </label>
            <label>
              <input type="radio" name="exportFormat" value="json"> JSON
            </label>
          </div>
        </div>
        <div class="mb-3">
          <label>Select Categories to Export:</label>
          <div id="exportCategories" class="mt-2">
            <label class="mr-2">
              <input type="checkbox" value="all" checked> All Categories
            </label>
            <!-- Categories will be added dynamically -->
          </div>
        </div>
        <div class="mb-3">
          <label>Script Types:</label>
          <div class="d-flex mt-2">
            <label class="mr-2">
              <input type="checkbox" id="exportBash" checked> Bash (.sh)
            </label>
            <label>
              <input type="checkbox" id="exportPowershell" checked> PowerShell (.ps1)
            </label>
          </div>
        </div>
        <div class="mb-3">
          <label for="exportPath">Export Path:</label>
          <input type="text" id="exportPath" placeholder="/path/to/export">
        </div>
      </div>
      <div class="modal-footer">
        <button id="cancelExportBtn" class="btn">Cancel</button>
        <button id="confirmExportBtn" class="btn btn-primary">Export</button>
      </div>
    </div>
  </div>

  <!-- View Script Modal -->
  <div id="viewScriptModal" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title" id="viewScriptTitle">Script Title</div>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <div class="d-flex justify-between align-center mb-2">
            <div>
              <span id="viewScriptType" class="badge">Type</span>
              <span id="viewScriptCategory" class="badge">Category</span>
              <span id="viewScriptDate">Date</span>
            </div>
            <div class="d-flex align-center">
              <span class="mr-2">Keywords:</span>
              <div id="viewScriptKeywords"></div>
            </div>
          </div>
          <div class="code-container">
            <pre class="code" id="viewScriptCode"></pre>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="copyScriptBtn" class="btn">
          <i class="fas fa-copy"></i> Copy
        </button>
        <button id="downloadScriptBtn" class="btn">
          <i class="fas fa-download"></i> Download
        </button>
        <button id="editScriptBtn" class="btn btn-primary">
          <i class="fas fa-edit"></i> Edit
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Script Modal -->
  <div id="editScriptModal" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Edit Script</div>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="editScriptTitle">Title:</label>
          <input type="text" id="editScriptTitle">
        </div>
        <div class="mb-3">
          <label for="editScriptCategory">Category:</label>
          <select id="editScriptCategory">
            <!-- Categories will be added dynamically -->
          </select>
        </div>
        <div class="mb-3">
          <label for="editScriptKeywords">Keywords (comma separated):</label>
          <input type="text" id="editScriptKeywords">
        </div>
        <div class="mb-3">
          <label for="editScriptCode">Script Code:</label>
          <textarea id="editScriptCode" rows="15"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button id="cancelEditBtn" class="btn">Cancel</button>
        <button id="saveEditBtn" class="btn btn-primary">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div id="notification" class="notification">
    <div class="notification-icon">
      <i class="fas fa-info-circle"></i>
    </div>
    <div class="notification-message">This is a notification message</div>
    <div class="notification-close">&times;</div>
  </div>

  <!-- Scroll to Top Button -->
  <div id="scrollTop" class="scroll-top">
    <i class="fas fa-arrow-up"></i>
  </div>

  <!-- Scripts -->
  <script>
    // WebSocket Connection and State Management
    const API_BASE_URL = '/api/script-generator';
    const WS_URL = `${window.location.protocol === 'https:' ? 'wss:' : 'ws:'}//${window.location.host}/script-generator`;
    
    // State management
    const state = {
      mode: 'auto', // 'auto' or 'manual'
      isConnected: false,
      isRunning: false,
      isPaused: false,
      scripts: [],
      generatorJobs: [],
      nextJobId: 1,
      categories: [],
      filters: {
        category: 'all',
        type: 'all',
        search: '',
        sort: 'date-desc'
      },
      settings: {
        model: 'gpt-4-turbo-preview',
        maxTokens: 2000,
        temperature: 0.7,
        defaultScriptsPerBatch: 5,
        defaultUpdateInterval: 30,
        defaultScriptTypes: ['bash', 'powershell'],
        maxParallelJobs: 3,
        cacheEnabled: true,
        seoKeywordEnabled: true,
        balanceCategories: true,
        autoStart: false
      },
      apiUsage: 0,
      keywords: [],
      ws: null,
      reconnectAttempts: 0,
      reconnectInterval: null,
      activeScriptId: null
    };

    // WebSocket connection management
    function connectWebSocket() {
      if (state.ws && state.ws.readyState !== WebSocket.CLOSED) {
        return; // Already connected or connecting
      }
      
      clearInterval(state.reconnectInterval);
      
      try {
        state.ws = new WebSocket(WS_URL);
        
        state.ws.onopen = handleWebSocketOpen;
        state.ws.onmessage = handleWebSocketMessage;
        state.ws.onclose = handleWebSocketClose;
        state.ws.onerror = handleWebSocketError;
        
        updateConnectionStatus('Connecting...', 'warning');
      } catch (error) {
        console.error('WebSocket connection error:', error);
        updateConnectionStatus('Connection error', 'error');
        scheduleReconnect();
      }
    }

    function handleWebSocketOpen() {
      console.log('WebSocket connected');
      state.isConnected = true;
      state.reconnectAttempts = 0;
      updateConnectionStatus('Connected', 'success');
      
      // Send a ping to keep the connection alive
      startPingInterval();
    }

    function startPingInterval() {
      if (state.pingInterval) {
        clearInterval(state.pingInterval);
      }
      
      state.pingInterval = setInterval(() => {
        if (state.ws && state.ws.readyState === WebSocket.OPEN) {
          state.ws.send(JSON.stringify({ type: 'ping' }));
        }
      }, 30000); // 30 second ping
    }

    function handleWebSocketMessage(event) {
      try {
        const message = JSON.parse(event.data);
        const { type, data, timestamp } = message;
        
        console.log('WebSocket message:', type, data);
        
        switch (type) {
          case 'connect':
            state.clientId = data.clientId;
            addLogEntry('Connected to server with client ID: ' + data.clientId);
            break;
            
          case 'generator_status':
            updateGeneratorState(data);
            break;
            
          case 'job_started':
            handleJobStarted(data);
            break;
            
          case 'job_progress':
            handleJobProgress(data);
            break;
            
          case 'job_completed':
            handleJobCompleted(data);
            break;
            
          case 'job_failed':
            handleJobFailed(data);
            break;
            
          case 'script_generated':
            handleScriptGenerated(data);
            break;
            
          case 'log':
            handleLogMessage(data);
            break;
            
          case 'notification':
            showNotification(data.message, data.type);
            break;
            
          case 'error':
            console.error('Server error:', data);
            showNotification(data.message, 'error');
            break;
        }
      } catch (error) {
        console.error('Error parsing WebSocket message:', error, event.data);
      }
    }

    function handleWebSocketClose(event) {
      console.log('WebSocket disconnected:', event.code, event.reason);
      state.isConnected = false;
      clearInterval(state.pingInterval);
      
      if (!event.wasClean) {
        updateConnectionStatus('Connection lost', 'error');
        scheduleReconnect();
      } else {
        updateConnectionStatus('Disconnected', 'warning');
      }
    }

    function handleWebSocketError(error) {
      console.error('WebSocket error:', error);
      updateConnectionStatus('Connection error', 'error');
    }

    function scheduleReconnect() {
      if (state.reconnectInterval) {
        clearInterval(state.reconnectInterval);
      }
      
      const delay = Math.min(30000, Math.pow(1.5, state.reconnectAttempts) * 1000);
      state.reconnectAttempts++;
      
      updateConnectionStatus(`Reconnecting in ${Math.round(delay/1000)}s...`, 'warning');
      
      state.reconnectInterval = setTimeout(() => {
        updateConnectionStatus('Reconnecting...', 'warning');
        connectWebSocket();
      }, delay);
    }

    function updateConnectionStatus(message, type = 'info') {
      const statusElem = document.getElementById('connectionStatus');
      statusElem.className = 'connection-status';
      
      let icon = 'fa-plug';
      if (type === 'success') icon = 'fa-link';
      if (type === 'warning') icon = 'fa-exclamation-triangle';
      if (type === 'error') icon = 'fa-unlink';
      
      statusElem.innerHTML = `<i class="fas ${icon}"></i> ${message}`;
      statusElem.classList.add(`status-${type}`);
    }

    // API calls
    async function apiCall(endpoint, method = 'GET', data = null) {
      try {
        const url = `${API_BASE_URL}${endpoint}`;
        const options = {
          method,
          headers: {
            'Content-Type': 'application/json'
          }
        };
        
        if (data && (method === 'POST' || method === 'PUT')) {
          options.body = JSON.stringify(data);
        }
        
        const response = await fetch(url, options);
        const result = await response.json();
        
        if (!response.ok) {
          throw new Error(result.message || 'API request failed');
        }
        
        return result;
      } catch (error) {
        console.error(`API error (${endpoint}):`, error);
        showNotification(`API Error: ${error.message}`, 'error');
        throw error;
      }
    }

    // Initialize the application
    async function init() {
      // Connect to WebSocket
      connectWebSocket();
      
      try {
        // Initialize generator if needed
        const initResponse = await apiCall('/init', 'POST');
        console.log('Generator initialized:', initResponse);
        
        // Load the generator state
        const stateResponse = await apiCall('/state');
        updateGeneratorState(stateResponse.data);
        
        // Update UI
        updateScriptsList();
        updateCategoriesList();
        updateKeywordsList();
        updateStatusPanel();
        updateGeneratorJobsList();
        
        // Add event listeners
        addEventListeners();
        
        // Show initial notification
        showNotification('System initialized. Ready to generate scripts.', 'info');
        
        // Load keywords
        updateKeywordsTerminal();
      } catch (error) {
        console.error('Initialization error:', error);
        showNotification('Failed to initialize: ' + error.message, 'error');
      }
    }

    // Update generator state from server
    function updateGeneratorState(data) {
      // Update state properties
      state.isRunning = data.isRunning;
      state.isPaused = data.isPaused;
      state.scripts = data.scripts || [];
      state.generatorJobs = data.jobs || [];
      state.categories = data.categories || [];
      state.keywords = data.keywords || [];
      state.apiUsage = data.apiUsage || 0;
      
      if (data.settings) {
        state.settings = data.settings;
      }
      
      // Update UI
      updateScriptsList();
      updateCategoriesList();
      updateKeywordsList();
      updateStatusPanel();
      updateGeneratorJobsList();
      updateKeywordsTerminal();
      
      // Update mode controls based on state
      updateModeControls();
    }

    // Handle new job started
    function handleJobStarted(job) {
      // Check if job already exists
      const existingJobIndex = state.generatorJobs.findIndex(j => j.id === job.id);
      
      if (existingJobIndex === -1) {
        // Add new job
        state.generatorJobs.push(job);
      } else {
        // Update existing job
        state.generatorJobs[existingJobIndex] = job;
      }
      
      // Update UI
      updateGeneratorJobsList();
      updateStatusPanel();
      
      // Log event
      addLogEntry(`Job started: ${job.name}`, 'success');
    }

    // Handle job progress update
    function handleJobProgress(job) {
      // Find and update job
      const jobIndex = state.generatorJobs.findIndex(j => j.id === job.id);
      
      if (jobIndex !== -1) {
        state.generatorJobs[jobIndex] = job;
        updateGeneratorJobsList();
      }
    }

    // Handle job completed
    function handleJobCompleted(job) {
      // Find and update job
      const jobIndex = state.generatorJobs.findIndex(j => j.id === job.id);
      
      if (jobIndex !== -1) {
        state.generatorJobs[jobIndex] = job;
        updateGeneratorJobsList();
        updateStatusPanel();
        
        // Log event
        addLogEntry(`Job completed: ${job.name}`, 'success');
        
        // Show notification
        showNotification(`Job "${job.name}" completed successfully`, 'success');
        
        // Remove job after a delay
        setTimeout(() => {
          const currentIndex = state.generatorJobs.findIndex(j => j.id === job.id);
          if (currentIndex !== -1) {
            state.generatorJobs.splice(currentIndex, 1);
            updateGeneratorJobsList();
          }
        }, 30000);
      }
    }

    // Handle job failed
    function handleJobFailed(job) {
      // Find and update job
      const jobIndex = state.generatorJobs.findIndex(j => j.id === job.id);
      
      if (jobIndex !== -1) {
        state.generatorJobs[jobIndex] = job;
        updateGeneratorJobsList();
        
        // Log event
        addLogEntry(`Job failed: ${job.name}`, 'error');
        
        // Show notification
        showNotification(`Job "${job.name}" failed: ${job.error || 'Unknown error'}`, 'error');
      }
    }

    // Handle new script generated
    function handleScriptGenerated(script) {
      // Add to scripts list (at the beginning)
      state.scripts.unshift(script);
      
      // Update UI
      updateScriptsList();
      
      // Log event
      addLogEntry(`Script generated: ${script.title}`, 'success');
    }

    // Handle log message from server
    function handleLogMessage(log) {
      // Add to log terminal
      addLogEntry(log.message, log.level);
    }

    // Toggle application mode
    function toggleMode() {
      state.mode = document.getElementById('modeSwitch').checked ? 'manual' : 'auto';
      
      // Update UI based on mode
      updateModeControls();
      
      // Log mode change
      addLogEntry(`Mode switched to ${state.mode.toUpperCase()}`);
    }

    // Update mode controls based on current mode
    function updateModeControls() {
      const modeSwitch = document.getElementById('modeSwitch');
      const modeDescription = document.getElementById('modeDescription');
      const autoModeControls = document.getElementById('autoModeControls');
      const manualModeControls = document.getElementById('manualModeControls');
      
      // Set switch based on mode
      modeSwitch.checked = state.mode === 'manual';
      
      if (state.mode === 'auto') {
        modeDescription.textContent = 'Auto mode: Scripts are generated automatically based on trending keywords.';
        autoModeControls.style.display = 'flex';
        manualModeControls.style.display = 'none';
        
        // Update button states based on generator status
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        
        startBtn.disabled = state.isRunning;
        pauseBtn.disabled = !state.isRunning;
        stopBtn.disabled = !state.isRunning;
        
        if (state.isRunning && state.isPaused) {
          pauseBtn.innerHTML = '<i class="fas fa-play"></i> Resume';
        } else {
          pauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
        }
      } else {
        modeDescription.textContent = 'Manual mode: Create and manage individual script generation jobs.';
        autoModeControls.style.display = 'none';
        manualModeControls.style.display = 'block';
      }
    }

    // Open manual job creation panel
    function showManualJobPanel() {
      document.getElementById('manualJobPanel').style.display = 'block';
      document.getElementById('generatorJobsPanel').style.display = 'none';
      
      // Set default job name
      document.getElementById('jobName').value = `Job ${state.nextJobId}`;
      
      // Clear other fields
      document.getElementById('jobKeywords').value = '';
      document.getElementById('scriptCount').value = '3';
      document.getElementById('generateBashManual').checked = true;
      document.getElementById('generatePowershellManual').checked = true;
      
      // Populate category dropdown
      const categorySelect = document.getElementById('scriptCategory');
      categorySelect.innerHTML = '<option value="all">All Categories</option>';
      
      state.categories.forEach(category => {
        if (category.enabled) {
          const option = document.createElement('option');
          option.value = category.id;
          option.textContent = category.name;
          categorySelect.appendChild(option);
        }
      });
    }

    // Hide manual job creation panel
    function hideManualJobPanel() {
      document.getElementById('manualJobPanel').style.display = 'none';
      document.getElementById('generatorJobsPanel').style.display = 'block';
    }

    // Create a new manual generator job
    async function createManualJob() {
      const name = document.getElementById('jobName').value.trim() || `Job ${state.nextJobId}`;
      const keywords = document.getElementById('jobKeywords').value.trim();
      const count = parseInt(document.getElementById('scriptCount').value) || 3;
      const category = document.getElementById('scriptCategory').value;
      const generateBash = document.getElementById('generateBashManual').checked;
      const generatePowershell = document.getElementById('generatePowershellManual').checked;
      
      // Validate inputs
      if (!keywords) {
        showNotification('Please enter keywords or theme for script generation', 'warning');
        return;
      }
      
      if (!generateBash && !generatePowershell) {
        showNotification('Please select at least one script type', 'warning');
        return;
      }
      
      try {
        // Show loading state
        document.getElementById('startManualJobBtn').disabled = true;
        document.getElementById('startManualJobBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
        
        // Create job via API
        const response = await apiCall('/job', 'POST', {
          name,
          keywords,
          scriptCount: count,
          category,
          generateBash,
          generatePowershell
        });
        
        // Hide panel
        hideManualJobPanel();
        
        // Increment ID counter
        state.nextJobId++;
        
        // Log job creation
        addLogEntry(`Created manual job: ${name}`);
        showNotification(`Manual job "${name}" created`, 'success');
      } catch (error) {
        console.error('Error creating job:', error);
        showNotification('Error creating job: ' + error.message, 'error');
      } finally {
        // Reset button state
        document.getElementById('startManualJobBtn').disabled = false;
        document.getElementById('startManualJobBtn').innerHTML = '<i class="fas fa-play"></i> Start Generation';
      }
    }

    // Start the generator
    async function startGenerator() {
      try {
        const startBtn = document.getElementById('startBtn');
        startBtn.disabled = true;
        startBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Starting...';
        
        const response = await apiCall('/start', 'POST');
        
        // Log action
        addLogEntry('Auto generator started');
        showNotification('Script generator started', 'success');
      } catch (error) {
        console.error('Error starting generator:', error);
        showNotification('Error starting generator: ' + error.message, 'error');
      } finally {
        document.getElementById('startBtn').innerHTML = '<i class="fas fa-play"></i> Start';
      }
    }

    // Toggle pause state
    async function togglePause() {
      try {
        const pauseBtn = document.getElementById('pauseBtn');
        pauseBtn.disabled = true;
        
        const response = await apiCall('/pause', 'POST');
        
        // Log based on the new state
        if (response.data && response.data.isPaused) {
          addLogEntry('Generator paused');
          showNotification('Script generator paused', 'warning');
        } else {
          addLogEntry('Generator resumed');
          showNotification('Script generator resumed', 'success');
        }
      } catch (error) {
        console.error('Error toggling pause state:', error);
        showNotification('Error toggling pause state: ' + error.message, 'error');
      } finally {
        document.getElementById('pauseBtn').disabled = false;
      }
    }

    // Stop the generator
    async function stopGenerator() {
      try {
        const stopBtn = document.getElementById('stopBtn');
        stopBtn.disabled = true;
        stopBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Stopping...';
        
        const response = await apiCall('/stop', 'POST');
        
        // Log action
        addLogEntry('Generator stopped');
        showNotification('Script generator stopped', 'error');
      } catch (error) {
        console.error('Error stopping generator:', error);
        showNotification('Error stopping generator: ' + error.message, 'error');
      } finally {
        document.getElementById('stopBtn').innerHTML = '<i class="fas fa-stop"></i> Stop';
      }
    }

    // Pause a specific job
    async function pauseJob(jobId) {
      try {
        const job = state.generatorJobs.find(j => j.id === jobId);
        if (!job) return;
        
        // This is just a UI update - the actual logic is handled by the server
        const button = document.querySelector(`.toggle-job-btn[data-id="${jobId}"]`);
        if (button) {
          button.disabled = true;
          button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        }
        
        // For now we'll just show a message that this feature is coming soon
        showNotification('Job pause/resume feature coming soon', 'warning');
        
        // Re-enable button after a short delay
        setTimeout(() => {
          const updatedButton = document.querySelector(`.toggle-job-btn[data-id="${jobId}"]`);
          if (updatedButton) {
            updatedButton.disabled = false;
            updatedButton.innerHTML = job.status === 'running' 
              ? '<i class="fas fa-pause"></i> Pause' 
              : '<i class="fas fa-play"></i> Resume';
          }
        }, 1000);
      } catch (error) {
        console.error(`Error toggling job ${jobId}:`, error);
        showNotification('Error toggling job: ' + error.message, 'error');
      }
    }

    // Cancel a specific job
    async function cancelJob(jobId) {
      try {
        const button = document.querySelector(`.cancel-job-btn[data-id="${jobId}"]`);
        if (button) {
          button.disabled = true;
          button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        }
        
        await apiCall(`/job/${jobId}`, 'DELETE');
        
        // The server will send a job_failed event which will update the UI
      } catch (error) {
        console.error(`Error canceling job ${jobId}:`, error);
        showNotification('Error canceling job: ' + error.message, 'error');
        
        // Re-enable button
        const button = document.querySelector(`.cancel-job-btn[data-id="${jobId}"]`);
        if (button) {
          button.disabled = false;
          button.innerHTML = '<i class="fas fa-times"></i> Cancel';
        }
      }
    }

    // Add a new keyword
    async function addKeyword() {
      const text = document.getElementById('newKeyword').value.trim();
      if (!text) {
        showNotification('Please enter a keyword', 'warning');
        return;
      }
      
      try {
        document.getElementById('addKeywordBtn').disabled = true;
        
        const response = await apiCall('/keyword', 'POST', { text });
        
        // Add to state
        state.keywords.push(response.data);
        
        // Update UI
        updateKeywordsList();
        
        // Clear input
        document.getElementById('newKeyword').value = '';
        
        addLogEntry(`Added keyword: ${text}`);
        showNotification('Keyword added successfully', 'success');
      } catch (error) {
        console.error('Error adding keyword:', error);
        showNotification('Error adding keyword: ' + error.message, 'error');
      } finally {
        document.getElementById('addKeywordBtn').disabled = false;
      }
    }

    // Fetch trending keywords
    async function fetchTrendingKeywords() {
      try {
        document.getElementById('fetchKeywordsBtn').disabled = true;
        document.getElementById('fetchKeywordsBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Fetching...';
        
        const response = await apiCall('/trending-keywords');
        
        if (response.success && response.data) {
          // Add each keyword via API
          for (const keyword of response.data) {
            try {
              await apiCall('/keyword', 'POST', keyword);
            } catch (error) {
              console.error(`Error adding trending keyword ${keyword.text}:`, error);
            }
          }
          
          // Refresh keywords list
          const stateResponse = await apiCall('/state');
          state.keywords = stateResponse.data.keywords || [];
          
          // Update UI
          updateKeywordsList();
          updateKeywordsTerminal();
          
          showNotification('Trending keywords fetched successfully', 'success');
          addLogEntry('Fetched trending keywords from API');
        }
      } catch (error) {
        console.error('Error fetching trending keywords:', error);
        showNotification('Error fetching trending keywords: ' + error.message, 'error');
      } finally {
        document.getElementById('fetchKeywordsBtn').disabled = false;
        document.getElementById('fetchKeywordsBtn').innerHTML = '<i class="fas fa-sync-alt"></i> Fetch Trending';
      }
    }

    // Clear all keywords
    async function clearKeywords() {
      if (confirm('Are you sure you want to clear all keywords?')) {
        try {
          // Delete each keyword via API
          for (const keyword of state.keywords) {
            try {
              await apiCall(`/keyword/${keyword.id}`, 'DELETE');
            } catch (error) {
              console.error(`Error deleting keyword ${keyword.id}:`, error);
            }
          }
          
          // Clear keywords in state
          state.keywords = [];
          
          // Update UI
          updateKeywordsList();
          updateKeywordsTerminal();
          
          showNotification('All keywords cleared', 'success');
          addLogEntry('Cleared all keywords');
        } catch (error) {
          console.error('Error clearing keywords:', error);
          showNotification('Error clearing keywords: ' + error.message, 'error');
        }
      }
    }

    // Update keywords list in the modal
    function updateKeywordsList() {
      const keywordsList = document.getElementById('keywordsList');
      const noKeywords = document.getElementById('noKeywords');
      const keywordsLoading = document.getElementById('keywordsLoading');
      
      if (keywordsLoading) {
        keywordsLoading.style.display = 'none';
      }
      
      if (state.keywords.length === 0) {
        keywordsList.innerHTML = '';
        noKeywords.style.display = 'block';
        return;
      }
      
      noKeywords.style.display = 'none';
      
      let html = '';
      state.keywords.forEach(keyword => {
        html += `
          <div class="keyword-item" data-id="${keyword.id}">
            <div class="keyword-text">${keyword.text}</div>
            <div class="keyword-actions">
              <span class="keyword-badge">${keyword.volume} searches</span>
              <span class="keyword-badge" style="color: ${keyword.growth.startsWith('+') ? 'var(--matrix-success)' : 'var(--matrix-error)'}">${keyword.growth}</span>
              <button class="btn btn-danger remove-keyword-btn" data-id="${keyword.id}">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
        `;
      });
      
      keywordsList.innerHTML = html;
      
      // Add event listeners to remove buttons
      document.querySelectorAll('.remove-keyword-btn').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          const id = e.currentTarget.getAttribute('data-id');
          
          try {
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            
            await apiCall(`/keyword/${id}`, 'DELETE');
            
            // Remove from state
            state.keywords = state.keywords.filter(k => k.id !== id);
            
            // Update UI
            updateKeywordsList();
            updateKeywordsTerminal();
            
            showNotification('Keyword deleted successfully', 'success');
          } catch (error) {
            console.error(`Error deleting keyword ${id}:`, error);
            showNotification('Error deleting keyword: ' + error.message, 'error');
          }
        });
      });
    }

    // Update keywords in the terminal
    function updateKeywordsTerminal() {
      // Clear the terminal
      const keywordsTerminal = document.getElementById('keywordsTerminal');
      keywordsTerminal.innerHTML = '';
      
      // Add each keyword to the terminal
      state.keywords.forEach((keyword, index) => {
        const line = document.createElement('div');
        line.className = 'terminal-line';
        
        const rank = document.createElement('span');
        rank.className = 'terminal-prompt';
        rank.textContent = `${index + 1}`;
        
        const content = document.createElement('span');
        content.innerHTML = `<strong>${keyword.text}</strong> - ${keyword.volume} searches/mo <span style="color: ${keyword.growth.startsWith('+') ? 'var(--matrix-success)' : 'var(--matrix-error)'};">${keyword.growth}</span>`;
        
        line.appendChild(rank);
        line.appendChild(content);
        
        keywordsTerminal.appendChild(line);
      });
      
      // If no keywords
      if (state.keywords.length === 0) {
        const line = document.createElement('div');
        line.className = 'terminal-line';
        
        const prompt = document.createElement('span');
        prompt.className = 'terminal-prompt';
        prompt.textContent = '';
        
        const content = document.createElement('span');
        content.textContent = 'No active keywords. Add keywords in the keywords manager.';
        
        line.appendChild(prompt);
        line.appendChild(content);
        
        keywordsTerminal.appendChild(line);
      }
    }

    // Update generator jobs list
    function updateGeneratorJobsList() {
      const generatorJobsList = document.getElementById('generatorJobsList');
      const noJobs = document.getElementById('noJobs');
      const activeJobsCount = document.getElementById('activeJobsCount');
      
      // Update active jobs count
      const activeJobs = state.generatorJobs.filter(job => 
        job.status === 'running' || job.status === 'pending'
      ).length;
      
      activeJobsCount.textContent = activeJobs;
      
      // Show/hide no jobs message
      if (state.generatorJobs.length === 0) {
        generatorJobsList.innerHTML = '';
        noJobs.style.display = 'block';
        return;
      }
      
      noJobs.style.display = 'none';
      
      // Sort jobs by start time (newest first)
      const sortedJobs = [...state.generatorJobs].sort((a, b) => b.startTime - a.startTime);
      
      // Build HTML
      let html = '';
      
      sortedJobs.forEach(job => {
        // Format estimated time
        const estimatedTime = job.status === 'completed' 
          ? 'Completed' 
          : `Est. completion: ${new Date(job.estimatedEndTime).toLocaleTimeString()}`;
          
        // Determine badge color based on status
        let statusClass = '';
        switch (job.status) {
          case 'running':
            statusClass = 'status-success';
            break;
          case 'paused':
            statusClass = 'status-warning';
            break;
          case 'pending':
            statusClass = 'status-warning';
            break;
          case 'completed':
            statusClass = 'status-success';
            break;
          case 'failed':
            statusClass = 'status-error';
            break;
          case 'canceled':
            statusClass = 'status-error';
            break;
        }
        
        html += `
          <div class="generator-job" data-id="${job.id}">
            <div class="generator-job-header">
              <div class="generator-job-title">${job.name}</div>
              <div class="generator-job-status">
                <span class="status ${statusClass}">${job.status.toUpperCase()}</span>
              </div>
            </div>
            <div class="generator-job-progress">
              <div class="progress-bar">
                <div class="progress-bar-fill" style="width: ${job.progress}%"></div>
              </div>
              <div class="d-flex justify-between">
                <span>${job.progress}% complete</span>
                <span>${job.scriptsGenerated} / ${job.scriptCount} scripts</span>
              </div>
            </div>
            <div class="generator-job-details">
              <div><strong>Mode:</strong> ${job.manualMode ? 'Manual' : 'Auto'}</div>
              <div><strong>Keywords:</strong> ${job.keywords.length > 50 ? job.keywords.substring(0, 50) + '...' : job.keywords}</div>
              <div><strong>Started:</strong> ${new Date(job.startTime).toLocaleString()}</div>
              <div><strong>Time Estimate:</strong> ${estimatedTime}</div>
            </div>
            <div class="generator-job-actions">
              ${job.status !== 'completed' && job.status !== 'canceled' ? `
                <button class="btn toggle-job-btn" data-id="${job.id}" ${job.status === 'pending' ? 'disabled' : ''}>
                  <i class="fas fa-${job.status === 'running' ? 'pause' : 'play'}"></i> ${job.status === 'running' ? 'Pause' : 'Resume'}
                </button>
                <button class="btn btn-danger cancel-job-btn" data-id="${job.id}">
                  <i class="fas fa-times"></i> Cancel
                </button>
              ` : `
                <button class="btn remove-job-btn" data-id="${job.id}">
                  <i class="fas fa-trash"></i> Remove
                </button>
              `}
            </div>
          </div>
        `;
      });
      
      generatorJobsList.innerHTML = html;
      
      // Add event listeners to job buttons
      document.querySelectorAll('.toggle-job-btn').forEach(button => {
        button.addEventListener('click', () => {
          const jobId = button.getAttribute('data-id');
          pauseJob(jobId);
        });
      });
      
      document.querySelectorAll('.cancel-job-btn, .remove-job-btn').forEach(button => {
        button.addEventListener('click', () => {
          const jobId = button.getAttribute('data-id');
          cancelJob(jobId);
        });
      });
    }

    // Update categories list
    function updateCategoriesList() {
      const categoriesList = document.getElementById('categoriesList');
      const loadingElement = document.getElementById('categories-loading');
      
      if (loadingElement) {
        loadingElement.style.display = 'none';
      }
      
      let html = '';
      
      state.categories.forEach(category => {
        html += `
          <div class="list-item">
            <span class="list-item-title">${category.name}</span>
            <div class="d-flex align-center">
              <span class="badge">${category.count}</span>
              <div class="toggle-switch ml-2">
                <input type="checkbox" id="category-${category.id}" ${category.enabled ? 'checked' : ''}>
                <span class="toggle-slider"></span>
              </div>
            </div>
          </div>
        `;
      });
      
      categoriesList.innerHTML = html;
      
      // Update category pills
      updateCategoryPills();
      
      // Add event listeners to category toggles
      state.categories.forEach(category => {
        const toggle = document.getElementById(`category-${category.id}`);
        if (toggle) {
          toggle.addEventListener('change', async () => {
            try {
              // Update server
              await apiCall(`/category/${category.id}`, 'PUT', {
                enabled: toggle.checked
              });
              
              // Update local state
              const index = state.categories.findIndex(c => c.id === category.id);
              if (index !== -1) {
                state.categories[index].enabled = toggle.checked;
                addLogEntry(`Category "${category.name}" ${toggle.checked ? 'enabled' : 'disabled'}`);
              }
            } catch (error) {
              console.error(`Error updating category ${category.id}:`, error);
              showNotification('Error updating category: ' + error.message, 'error');
              
              // Reset toggle to original state
              toggle.checked = category.enabled;
            }
          });
        }
      });
    }

    // Update category pills
    function updateCategoryPills() {
      const categoryPills = document.getElementById('categoryPills');
      
      // Keep the "All" pill
      const allPill = categoryPills.querySelector('.category-pill[data-category="all"]');
      categoryPills.innerHTML = '';
      categoryPills.appendChild(allPill);
      
      // Add pills for each category
      state.categories.forEach(category => {
        const pill = document.createElement('div');
        pill.className = 'category-pill';
        pill.setAttribute('data-category', category.id);
        pill.textContent = category.name;
        
        // Set active if this is the currently selected category
        if (state.filters.category === category.id) {
          pill.classList.add('active');
        }
        
        pill.addEventListener('click', () => {
          document.querySelectorAll('.category-pill').forEach(p => p.classList.remove('active'));
          pill.classList.add('active');
          state.filters.category = category.id;
          updateScriptsList();
        });
        
        categoryPills.appendChild(pill);
      });
      
      // Also update export categories
      updateExportCategories();
      
      // And update edit script category dropdown
      updateEditScriptCategories();
    }

    // Update export categories checkboxes
    function updateExportCategories() {
      const exportCategories = document.getElementById('exportCategories');
      
      // Keep the "All" option
      const allOption = exportCategories.querySelector('label');
      exportCategories.innerHTML = '';
      exportCategories.appendChild(allOption);
      
      // Add each category
      state.categories.forEach(category => {
        const label = document.createElement('label');
        label.className = 'mr-2';
        label.innerHTML = `
          <input type="checkbox" value="${category.id}"> ${category.name}
        `;
        exportCategories.appendChild(label);
      });
    }

    // Update edit script category dropdown
    function updateEditScriptCategories() {
      const categorySelect = document.getElementById('editScriptCategory');
      if (!categorySelect) return;
      
      categorySelect.innerHTML = '';
      
      // Add each category
      state.categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category.id;
        option.textContent = category.name;
        categorySelect.appendChild(option);
      });
    }

    // Update scripts list
    function updateScriptsList() {
      // Apply filters
      let filteredScripts = [...state.scripts];
      
      // Filter by category
      if (state.filters.category !== 'all') {
        filteredScripts = filteredScripts.filter(script => script.category === state.filters.category);
      }
      
      // Filter by type
      if (state.filters.type !== 'all') {
        filteredScripts = filteredScripts.filter(script => script.type === state.filters.type);
      }
      
      // Filter by search query
      if (state.filters.search) {
        const searchTerm = state.filters.search.toLowerCase();
        filteredScripts = filteredScripts.filter(script => {
          return (
            script.title.toLowerCase().includes(searchTerm) ||
            script.description?.toLowerCase().includes(searchTerm) ||
            script.keywords.some(keyword => typeof keyword === 'string' && keyword.toLowerCase().includes(searchTerm))
          );
        });
      }
      
      // Sort scripts
      switch (state.filters.sort) {
        case 'date-desc':
          filteredScripts.sort((a, b) => b.created - a.created);
          break;
        case 'date-asc':
          filteredScripts.sort((a, b) => a.created - b.created);
          break;
        case 'name-asc':
          filteredScripts.sort((a, b) => a.title.localeCompare(b.title));
          break;
        case 'name-desc':
          filteredScripts.sort((a, b) => b.title.localeCompare(a.title));
          break;
      }
      
      // Update search results text
      const searchResults = document.getElementById('searchResults');
      searchResults.textContent = `Showing ${filteredScripts.length} of ${state.scripts.length} scripts`;
      
      // Get the scripts list and loading elements
      const scriptsList = document.getElementById('scriptsList');
      const loadingScripts = document.getElementById('loadingScripts');
      const noScripts = document.getElementById('noScripts');
      
      // Hide loading indicator
      if (loadingScripts) {
        loadingScripts.style.display = 'none';
      }
      
      // Show/hide "no scripts" message
      if (filteredScripts.length === 0) {
        scriptsList.innerHTML = '';
        noScripts.style.display = 'flex';
      } else {
        noScripts.style.display = 'none';
        
        // Build HTML for scripts
        let html = '';
        
        filteredScripts.forEach(script => {
          const date = new Date(script.created).toLocaleDateString();
          const time = new Date(script.created).toLocaleTimeString();
          
          html += `
            <div class="script-item" data-id="${script.id}">
              <div class="script-header">
                <div>
                  <div class="script-title">${script.title}</div>
                  <div class="script-subtitle">${script.description || ''}</div>
                </div>
                <div class="script-actions">
                  <button class="btn view-script-btn" data-id="${script.id}">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              </div>
              <div class="script-footer">
                <div class="script-meta">
                  <span class="badge">${script.type === 'bash' ? 'Bash' : 'PowerShell'}</span>
                  <span class="badge">${script.category}</span>
                  <span>${date}</span>
                </div>
                <div>
                  <span class="badge">SEO: ${script.seoScore || 85}</span>
                  ${script.jobId ? `<span class="badge">Job: ${script.jobId.substring(0, 8)}</span>` : ''}
                </div>
              </div>
            </div>
          `;
        });
        
        scriptsList.innerHTML = html;
        
        // Add event listeners to view buttons
        document.querySelectorAll('.view-script-btn').forEach(button => {
          button.addEventListener('click', () => {
            const scriptId = button.getAttribute('data-id');
            viewScript(scriptId);
          });
        });
      }
      
      // Update scripts count
      document.getElementById('scriptsCount').textContent = state.scripts.length;
    }

    // Add a new category
    async function addNewCategory() {
      const name = document.getElementById('newCategoryName').value.trim();
      const description = document.getElementById('newCategoryDesc').value.trim();
      
      if (!name) {
        showNotification('Please enter a category name', 'warning');
        return;
      }
      
      try {
        document.getElementById('saveNewCategoryBtn').disabled = true;
        
        const response = await apiCall('/category', 'POST', {
          name,
          description
        });
        
        // Update state if successful
        if (response.success) {
          // Refresh categories from server
          const stateResponse = await apiCall('/state');
          state.categories = stateResponse.data.categories || [];
          
          // Update UI
          updateCategoriesList();
          
          // Close modal and reset form
          document.getElementById('addCategoryModal').classList.remove('show');
          document.getElementById('newCategoryName').value = '';
          document.getElementById('newCategoryDesc').value = '';
          
          // Log and notify
          addLogEntry(`Added new category: ${name}`);
          showNotification(`Category "${name}" added successfully`, 'success');
        }
      } catch (error) {
        console.error('Error adding category:', error);
        showNotification('Error adding category: ' + error.message, 'error');
      } finally {
        document.getElementById('saveNewCategoryBtn').disabled = false;
      }
    }

    // View script details
    async function viewScript(scriptId) {
      try {
        // Show loading state
        const viewScriptModal = document.getElementById('viewScriptModal');
        const viewScriptTitle = document.getElementById('viewScriptTitle');
        viewScriptTitle.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
        viewScriptModal.classList.add('show');
        
        // Get script details from the server
        const response = await apiCall(`/script/${scriptId}`);
        const script = response.data;
        
        // Save active script ID
        state.activeScriptId = scriptId;
        
        // Update modal content
        viewScriptTitle.textContent = script.title;
        document.getElementById('viewScriptType').textContent = script.type === 'bash' ? 'Bash' : 'PowerShell';
        document.getElementById('viewScriptCategory').textContent = script.category;
        document.getElementById('viewScriptDate').textContent = new Date(script.created).toLocaleString();
        
        // Keywords
        const viewScriptKeywords = document.getElementById('viewScriptKeywords');
        viewScriptKeywords.innerHTML = '';
        script.keywords.forEach(keyword => {
          const span = document.createElement('span');
          span.className = 'badge';
          span.textContent = keyword;
          viewScriptKeywords.appendChild(span);
        });
        
        // Code
        document.getElementById('viewScriptCode').textContent = script.code;
      } catch (error) {
        console.error(`Error viewing script ${scriptId}:`, error);
        document.getElementById('viewScriptModal').classList.remove('show');
        showNotification('Error viewing script: ' + error.message, 'error');
      }
    }

    // Copy script to clipboard
    function copyScriptToClipboard() {
      if (!state.activeScriptId) return;
      
      const scriptCode = document.getElementById('viewScriptCode').textContent;
      
      navigator.clipboard.writeText(scriptCode)
        .then(() => {
          showNotification('Script copied to clipboard', 'success');
        })
        .catch(err => {
          console.error('Failed to copy script:', err);
          showNotification('Failed to copy script', 'error');
        });
    }

    // Download script
    async function downloadScript() {
      if (!state.activeScriptId) return;
      
      try {
        const response = await apiCall(`/script/${state.activeScriptId}`);
        const script = response.data;
        
        const extension = script.type === 'bash' ? '.sh' : '.ps1';
        const filename = script.title.toLowerCase().replace(/\s+/g, '-') + extension;
        const blob = new Blob([script.code], { type: 'text/plain' });
        
        // Create a download link
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        
        // Clean up
        setTimeout(() => {
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }, 100);
        
        addLogEntry(`Script "${script.title}" downloaded as ${filename}`);
        showNotification(`Script downloaded as ${filename}`, 'success');
      } catch (error) {
        console.error('Error downloading script:', error);
        showNotification('Error downloading script: ' + error.message, 'error');
      }
    }

    // Open edit script modal
    function openEditScriptModal() {
      if (!state.activeScriptId) return;
      
      // Hide view modal and show edit modal
      document.getElementById('viewScriptModal').classList.remove('show');
      
      // Get script details
      apiCall(`/script/${state.activeScriptId}`).then(response => {
        const script = response.data;
        
        // Fill in the edit form
        document.getElementById('editScriptTitle').value = script.title;
        document.getElementById('editScriptCategory').value = script.category;
        document.getElementById('editScriptKeywords').value = script.keywords.join(', ');
        document.getElementById('editScriptCode').value = script.code;
        
        // Show edit modal
        document.getElementById('editScriptModal').classList.add('show');
      }).catch(error => {
        console.error('Error getting script for editing:', error);
        showNotification('Error preparing script for editing: ' + error.message, 'error');
      });
    }

    // Save script edit
    async function saveScriptEdit() {
      if (!state.activeScriptId) return;
      
      const title = document.getElementById('editScriptTitle').value;
      const category = document.getElementById('editScriptCategory').value;
      const keywords = document.getElementById('editScriptKeywords').value.split(',').map(k => k.trim()).filter(k => k);
      const code = document.getElementById('editScriptCode').value;
      
      if (!title) {
        showNotification('Title is required', 'warning');
        return;
      }
      
      try {
        document.getElementById('saveEditBtn').disabled = true;
        document.getElementById('saveEditBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        
        const response = await apiCall(`/script/${state.activeScriptId}`, 'PUT', {
          title,
          category,
          keywords,
          code
        });
        
        // Update state
        const scriptIndex = state.scripts.findIndex(s => s.id === state.activeScriptId);
        if (scriptIndex !== -1) {
          state.scripts[scriptIndex] = response.data;
        }
        
        // Update UI
        updateScriptsList();
        
        // Close modal
        document.getElementById('editScriptModal').classList.remove('show');
        
        // Log and notify
        addLogEntry(`Script "${title}" updated`);
        showNotification('Script updated successfully', 'success');
      } catch (error) {
        console.error('Error updating script:', error);
        showNotification('Error updating script: ' + error.message, 'error');
      } finally {
        document.getElementById('saveEditBtn').disabled = false;
        document.getElementById('saveEditBtn').innerHTML = 'Save Changes';
      }
    }

    // Export scripts
    async function exportScripts() {
      // Get export settings
      const format = document.querySelector('input[name="exportFormat"]:checked').value;
      
      const categoryCheckboxes = document.querySelectorAll('#exportCategories input:checked');
      const categories = Array.from(categoryCheckboxes).map(input => input.value);
      
      const includeBash = document.getElementById('exportBash').checked;
      const includePowershell = document.getElementById('exportPowershell').checked;
      
      const exportPath = document.getElementById('exportPath').value.trim();
      
      // Validate inputs
      if (categories.length === 0) {
        showNotification('Please select at least one category', 'warning');
        return;
      }
      
      if (!includeBash && !includePowershell) {
        showNotification('Please select at least one script type', 'warning');
        return;
      }
      
      // Show loading state
      document.getElementById('confirmExportBtn').disabled = true;
      document.getElementById('confirmExportBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Exporting...';
      
      // Currently this is just a simulation since the server doesn't have a full export implementation
      // Show a message indicating this
      setTimeout(() => {
        // Close modal
        document.getElementById('exportModal').classList.remove('show');
        
        // Reset button
        document.getElementById('confirmExportBtn').disabled = false;
        document.getElementById('confirmExportBtn').innerHTML = 'Export';
        
        // Success message
        showNotification(`Scripts export feature will be available in the next update`, 'info');
        addLogEntry(`Export requested (format: ${format}, path: ${exportPath || 'default'})`);
      }, 2000);
    }

    // Update status panel
    function updateStatusPanel() {
      // Update service status
      const serviceStatus = document.getElementById('serviceStatus');
      
      if (state.isRunning) {
        if (state.isPaused) {
          serviceStatus.textContent = 'Paused';
          serviceStatus.className = 'status status-warning';
        } else {
          serviceStatus.textContent = 'Running';
          serviceStatus.className = 'status status-success';
        }
      } else {
        serviceStatus.textContent = 'Stopped';
        serviceStatus.className = 'status status-error';
      }
      
      // Update API status
      const apiStatus = document.getElementById('apiStatus');
      
      if (state.isConnected) {
        apiStatus.textContent = 'Connected';
        apiStatus.className = 'status status-success';
      } else {
        apiStatus.textContent = 'Disconnected';
        apiStatus.className = 'status status-error';
      }
      
      // Update scripts count
      document.getElementById('scriptsCount').textContent = state.scripts.length;
      
      // Update active jobs count
      document.getElementById('activeJobsCount').textContent = state.generatorJobs.filter(job => 
        job.status === 'running' || job.status === 'pending'
      ).length;
      
      // Update API usage
      document.getElementById('apiUsage').style.width = `${state.apiUsage}%`;
      document.getElementById('apiUsageText').textContent = `${state.apiUsage}%`;
      
      // Update last update time
      if (state.scripts.length > 0) {
        const lastScriptTime = new Date(Math.max(...state.scripts.map(s => s.created))).toLocaleTimeString();
        document.getElementById('lastUpdate').textContent = lastScriptTime;
      } else {
        document.getElementById('lastUpdate').textContent = 'Never';
      }
      
      // Update mode controls
      updateModeControls();
    }

    // Refresh scripts list
    async function refreshScripts() {
      try {
        // Show loading state
        document.getElementById('loadingScripts').style.display = 'flex';
        document.getElementById('refreshBtn').disabled = true;
        
        // Get latest state from server
        const response = await apiCall('/state');
        
        // Update state
        state.scripts = response.data.scripts || [];
        
        // Update UI
        updateScriptsList();
        
        // Log refresh
        addLogEntry('Scripts list refreshed');
        showNotification('Scripts list refreshed', 'success');
      } catch (error) {
        console.error('Error refreshing scripts:', error);
        showNotification('Error refreshing scripts: ' + error.message, 'error');
      } finally {
        document.getElementById('loadingScripts').style.display = 'none';
        document.getElementById('refreshBtn').disabled = false;
      }
    }

    // Refresh generator jobs
    async function refreshJobs() {
      try {
        document.getElementById('refreshJobsBtn').disabled = true;
        
        // Get latest state from server
        const response = await apiCall('/state');
        
        // Update state
        state.generatorJobs = response.data.jobs || [];
        
        // Update UI
        updateGeneratorJobsList();
        
        // Log refresh
        addLogEntry('Generator jobs refreshed');
        showNotification('Generator jobs refreshed', 'success');
      } catch (error) {
        console.error('Error refreshing jobs:', error);
        showNotification('Error refreshing jobs: ' + error.message, 'error');
      } finally {
        document.getElementById('refreshJobsBtn').disabled = false;
      }
    }

    // Clear the log terminal
    function clearLog() {
      document.getElementById('logTerminal').innerHTML = '';
      addLogEntry('Log cleared');
    }

    // Toggle theme
    function toggleTheme() {
      const root = document.documentElement;
      const currentBg = getComputedStyle(root).getPropertyValue('--matrix-bg').trim();
      
      if (currentBg === '#0c0c0c') {
        // Switch to light mode
        root.style.setProperty('--matrix-bg', '#f5f5f5');
        root.style.setProperty('--matrix-text', '#007c21');
        root.style.setProperty('--matrix-glow', 'rgba(0, 255, 65, 0)');
        root.style.setProperty('--matrix-dim', '#e0f5e0');
        root.style.setProperty('--matrix-panel', '#ffffff');
        root.style.setProperty('--matrix-border', '#cccccc');
        root.style.setProperty('--matrix-secondary', '#ebfff1');
        document.getElementById('digitalRain').style.opacity = '0.1';
        document.getElementById('modeToggle').innerHTML = '<i class="fas fa-moon"></i>';
        addLogEntry('Switched to light theme');
      } else {
        // Switch to matrix mode
        root.style.setProperty('--matrix-bg', '#0c0c0c');
        root.style.setProperty('--matrix-text', '#00ff41');
        root.style.setProperty('--matrix-glow', 'rgba(0, 255, 65, 0.3)');
        root.style.setProperty('--matrix-dim', '#0f3d0f');
        root.style.setProperty('--matrix-panel', '#0f0f0f');
        root.style.setProperty('--matrix-border', '#143214');
        root.style.setProperty('--matrix-secondary', '#072707');
        document.getElementById('digitalRain').style.opacity = '0.3';
        document.getElementById('modeToggle').innerHTML = '<i class="fas fa-sun"></i>';
        addLogEntry('Switched to dark theme');
      }
    }

    // Show notification
    function showNotification(message, type = 'info') {
      const notificationElem = document.getElementById('notification');
      const messageElem = notificationElem.querySelector('.notification-message');
      const iconElem = notificationElem.querySelector('.notification-icon i');
      
      // Set message
      messageElem.textContent = message;
      
      // Set type
      notificationElem.className = 'notification';
      notificationElem.classList.add(`notification-${type}`);
      
      // Set icon
      iconElem.className = '';
      switch (type) {
        case 'success':
          iconElem.className = 'fas fa-check-circle';
          break;
        case 'error':
          iconElem.className = 'fas fa-exclamation-circle';
          break;
        case 'warning':
          iconElem.className = 'fas fa-exclamation-triangle';
          break;
        default:
          iconElem.className = 'fas fa-info-circle';
      }
      
      // Show notification
      notificationElem.classList.add('show');
      
      // Auto-hide after 5 seconds
      setTimeout(() => {
        notificationElem.classList.remove('show');
      }, 5000);
    }

    // Add log entry
    function addLogEntry(message, type = 'info') {
      const logTerminal = document.getElementById('logTerminal');
      
      const line = document.createElement('div');
      line.className = 'terminal-line';
      
      const prompt = document.createElement('span');
      prompt.className = 'terminal-prompt';
      
      const time = new Date().toLocaleTimeString();
      
      switch (type) {
        case 'success':
          prompt.textContent = '+';
          prompt.style.color = 'var(--matrix-success)';
          break;
        case 'error':
          prompt.textContent = '!';
          prompt.style.color = 'var(--matrix-error)';
          break;
        case 'warning':
          prompt.textContent = '?';
          prompt.style.color = 'var(--matrix-warning)';
          break;
        default:
          prompt.textContent = '>';
      }
      
      const content = document.createElement('span');
      content.innerHTML = `[${time}] ${message}`;
      
      if (type === 'error') {
        content.style.color = 'var(--matrix-error)';
      } else if (type === 'warning') {
        content.style.color = 'var(--matrix-warning)';
      } else if (type === 'success') {
        content.style.color = 'var(--matrix-success)';
      }
      
      line.appendChild(prompt);
      line.appendChild(content);
      
      logTerminal.appendChild(line);
      logTerminal.scrollTop = logTerminal.scrollHeight;
      
      // Send log to server (in a real app we would do this)
      if (state.ws && state.ws.readyState === WebSocket.OPEN) {
        // This is commented out as it's not actually supported by our server
        // state.ws.send(JSON.stringify({
        //   type: 'log',
        //   data: {
        //     level: type,
        //     message: message
        //   }
        // }));
      }
    }

    // Save settings
    async function saveSettings() {
      // Get values from form
      const settings = {
        model: document.getElementById('gptModel').value,
        defaultUpdateInterval: parseInt(document.getElementById('updateInterval').value) || 30,
        defaultScriptsPerBatch: parseInt(document.getElementById('scriptsPerUpdate').value) || 5,
        autoStart: document.getElementById('autoStart').checked,
        seoKeywordEnabled: document.getElementById('includeSeo').checked,
        defaultScriptTypes: [],
        balanceCategories: document.getElementById('balanceCategories').checked,
        maxParallelJobs: parseInt(document.getElementById('maxParallelJobs').value) || 3,
        cacheEnabled: document.getElementById('cacheEnabled').checked,
        maxTokens: parseInt(document.getElementById('maxTokens').value) || 2000,
        temperature: parseFloat(document.getElementById('temperature').value) || 0.7
      };
      
      // Add script types
      if (document.getElementById('generateBash').checked) {
        settings.defaultScriptTypes.push('bash');
      }
      
      if (document.getElementById('generatePowershell').checked) {
        settings.defaultScriptTypes.push('powershell');
      }
      
      try {
        // Show loading state
        document.getElementById('saveSettingsBtn').disabled = true;
        document.getElementById('saveSettingsBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        
        // Save settings via API
        const response = await apiCall('/settings', 'PUT', settings);
        
        // Update local state
        state.settings = response.data;
        
        // Close modal
        document.getElementById('settingsModal').classList.remove('show');
        
        // Log and notify
        addLogEntry('Settings saved');
        showNotification('Settings saved successfully', 'success');
      } catch (error) {
        console.error('Error saving settings:', error);
        showNotification('Error saving settings: ' + error.message, 'error');
      } finally {
        document.getElementById('saveSettingsBtn').disabled = false;
        document.getElementById('saveSettingsBtn').innerHTML = 'Save Settings';
      }
    }

    // Reset settings to default
    function resetSettings() {
      // This resets the UI only - the server-side reset is managed separately
      document.getElementById('gptModel').value = 'gpt-4-turbo-preview';
      document.getElementById('updateInterval').value = '30';
      document.getElementById('scriptsPerUpdate').value = '5';
      document.getElementById('autoStart').checked = false;
      document.getElementById('includeSeo').checked = true;
      document.getElementById('generateBash').checked = true;
      document.getElementById('generatePowershell').checked = true;
      document.getElementById('balanceCategories').checked = true;
      document.getElementById('maxParallelJobs').value = '3';
      document.getElementById('cacheEnabled').checked = true;
      document.getElementById('maxTokens').value = '2000';
      document.getElementById('temperature').value = '0.7';
      document.getElementById('temperatureValue').textContent = '0.7';
      
      showNotification('Settings reset to default', 'info');
    }

    // Add all event listeners
    function addEventListeners() {
      // Mode Switch
      document.getElementById('modeSwitch').addEventListener('change', toggleMode);
      
      // Manual Job Creation
      document.getElementById('createJobBtn').addEventListener('click', showManualJobPanel);
      document.getElementById('startManualJobBtn').addEventListener('click', createManualJob);
      document.getElementById('cancelManualJobBtn').addEventListener('click', hideManualJobPanel);
      
      // Generator Jobs
      document.getElementById('refreshJobsBtn').addEventListener('click', refreshJobs);
      
      // Settings Modal
      document.getElementById('settingsBtn').addEventListener('click', () => {
        // Populate settings form with current values
        document.getElementById('gptModel').value = state.settings.model;
        document.getElementById('updateInterval').value = state.settings.defaultUpdateInterval;
        document.getElementById('scriptsPerUpdate').value = state.settings.defaultScriptsPerBatch;
        document.getElementById('autoStart').checked = state.settings.autoStart;
        document.getElementById('includeSeo').checked = state.settings.seoKeywordEnabled;
        document.getElementById('generateBash').checked = state.settings.defaultScriptTypes.includes('bash');
        document.getElementById('generatePowershell').checked = state.settings.defaultScriptTypes.includes('powershell');
        document.getElementById('balanceCategories').checked = state.settings.balanceCategories;
        document.getElementById('maxParallelJobs').value = state.settings.maxParallelJobs;
        document.getElementById('cacheEnabled').checked = state.settings.cacheEnabled;
        document.getElementById('maxTokens').value = state.settings.maxTokens;
        document.getElementById('temperature').value = state.settings.temperature;
        document.getElementById('temperatureValue').textContent = state.settings.temperature;
        
        document.getElementById('settingsModal').classList.add('show');
      });
      
      document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);
      document.getElementById('resetSettingsBtn').addEventListener('click', resetSettings);
      
      document.getElementById('temperature').addEventListener('input', () => {
        document.getElementById('temperatureValue').textContent = document.getElementById('temperature').value;
      });
      
      // Control Buttons
      document.getElementById('startBtn').addEventListener('click', startGenerator);
      document.getElementById('pauseBtn').addEventListener('click', togglePause);
      document.getElementById('stopBtn').addEventListener('click', stopGenerator);
      document.getElementById('refreshBtn').addEventListener('click', refreshScripts);
      document.getElementById('clearLogBtn').addEventListener('click', clearLog);
      
      // Category Management
      document.getElementById('addCategoryBtn').addEventListener('click', () => {
        document.getElementById('addCategoryModal').classList.add('show');
      });
      
      document.getElementById('saveNewCategoryBtn').addEventListener('click', addNewCategory);
      document.getElementById('cancelAddCategoryBtn').addEventListener('click', () => {
        document.getElementById('addCategoryModal').classList.remove('show');
      });
      
      // Keyword Management
      document.getElementById('keywordsBtn').addEventListener('click', () => {
        document.getElementById('keywordsModal').classList.add('show');
        updateKeywordsList();
      });
      
      document.getElementById('addKeywordBtn').addEventListener('click', addKeyword);
      document.getElementById('fetchKeywordsBtn').addEventListener('click', fetchTrendingKeywords);
      document.getElementById('clearKeywordsBtn').addEventListener('click', clearKeywords);
      document.getElementById('saveKeywordsBtn').addEventListener('click', () => {
        document.getElementById('keywordsModal').classList.remove('show');
        showNotification('Keywords saved successfully', 'success');
      });
      
      // Category Pills
      document.getElementById('categoryPills').addEventListener('click', (event) => {
        if (event.target.classList.contains('category-pill')) {
          document.querySelectorAll('.category-pill').forEach(pill => pill.classList.remove('active'));
          event.target.classList.add('active');
          state.filters.category = event.target.getAttribute('data-category');
          updateScriptsList();
        }
      });
      
      // Filters
      document.getElementById('scriptTypeFilter').addEventListener('change', () => {
        state.filters.type = document.getElementById('scriptTypeFilter').value;
        updateScriptsList();
      });
      
      document.getElementById('searchInput').addEventListener('input', () => {
        state.filters.search = document.getElementById('searchInput').value.trim().toLowerCase();
        updateScriptsList();
      });
      
      document.getElementById('sortOrder').addEventListener('change', () => {
        state.filters.sort = document.getElementById('sortOrder').value;
        updateScriptsList();
      });
      
      // Export
      document.getElementById('exportBtn').addEventListener('click', () => {
        document.getElementById('exportModal').classList.add('show');
      });
      
      document.getElementById('confirmExportBtn').addEventListener('click', exportScripts);
      document.getElementById('cancelExportBtn').addEventListener('click', () => {
        document.getElementById('exportModal').classList.remove('show');
      });
      
      // Script Actions
      document.getElementById('copyScriptBtn').addEventListener('click', copyScriptToClipboard);
      document.getElementById('downloadScriptBtn').addEventListener('click', downloadScript);
      document.getElementById('editScriptBtn').addEventListener('click', openEditScriptModal);
      
      // Edit Script
      document.getElementById('saveEditBtn').addEventListener('click', saveScriptEdit);
      document.getElementById('cancelEditBtn').addEventListener('click', () => {
        document.getElementById('editScriptModal').classList.remove('show');
      });
      
      // Notification
      document.querySelector('.notification-close').addEventListener('click', () => {
        document.getElementById('notification').classList.remove('show');
      });
      
      // Scroll to Top
      document.getElementById('scrollTop').addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
      
      // Window scroll event for scroll to top button
      window.addEventListener('scroll', () => {
        if (window.pageYOffset > 300) {
          document.getElementById('scrollTop').classList.add('visible');
        } else {
          document.getElementById('scrollTop').classList.remove('visible');
        }
      });
      
      // Theme toggle
      document.getElementById('modeToggle').addEventListener('click', toggleTheme);
      
      // Close modals when clicking close button
      document.querySelectorAll('.modal-close').forEach(button => {
        button.addEventListener('click', () => {
          document.querySelectorAll('.modal-backdrop').forEach(modal => {
            modal.classList.remove('show');
          });
        });
      });
      
      // Also close modals when clicking outside
      document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
        backdrop.addEventListener('click', (event) => {
          if (event.target === backdrop) {
            backdrop.classList.remove('show');
          }
        });
      });
      
      // Add event listener for new keyword form submission
      document.getElementById('newKeyword').addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
          event.preventDefault();
          addKeyword();
        }
      });
    }

    // Digital Rain Effect
    function initDigitalRain() {
      const canvas = document.getElementById('digitalRain');
      const ctx = canvas.getContext('2d');
      
      // Set canvas dimensions
      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      
      resize();
      window.addEventListener('resize', resize);
      
      // Define Matrix characters
      const chars = '01アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン';
      const charArray = chars.split('');
      
      // Create rain drops
      const fontSize = 14;
      const columns = Math.floor(canvas.width / fontSize);
      
      const drops = [];
      for (let i = 0; i < columns; i++) {
        drops[i] = Math.floor(Math.random() * canvas.height / fontSize);
      }
      
      // Drawing function
      function draw() {
        // Add semi-transparent black rectangle to create fade effect
        ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Set text color and font
        ctx.fillStyle = '#00ff41';
        ctx.font = `${fontSize}px monospace`;
        
        // Draw characters
        for (let i = 0; i < drops.length; i++) {
          // Choose a random character
          const char = charArray[Math.floor(Math.random() * charArray.length)];
          
          // Draw character
          ctx.fillText(char, i * fontSize, drops[i] * fontSize);
          
          // If drop reaches bottom or random chance, reset to top
          if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
            drops[i] = 0;
          }
          
          // Move drop down
          drops[i]++;
        }
      }
      
      // Animation loop
      function animate() {
        draw();
        requestAnimationFrame(animate);
      }
      
      animate();
    }

    // Initialize on document load
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize digital rain effect
      initDigitalRain();
      
      // Initialize the application
      init();
    });